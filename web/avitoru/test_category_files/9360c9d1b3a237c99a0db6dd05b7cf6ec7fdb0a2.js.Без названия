window.avito.coords=window.avito.coords||{},window.avito.coords.precisionMap={10:1,11:1.5,12:2,13:2,14:2.5,15:3,16:3,17:3.5,18:3.5,19:4},function(){"use strict";var e;e=function(){var e,t;return function(){return t||(e=$.Deferred(function(e){window.avito||(window.avito={}),window.avito.ymapsReady||(window.avito.ymapsReady=e.resolve),$.ajax({url:"//api-maps.yandex.ru/2.1/?lang=ru-RU&onload=avito.ymapsReady",dataType:"script",cache:!0}).fail(e.reject)}),t=e.promise())}}(),$.YandexMap=function(t){var o={},n=e();return o.init=function(e){var a=$.Deferred();return n.done(function(){var n,s;for(t.empty(),(e=$.extend(!0,{map:{type:"yandex#map",controls:[]},controls:[],behaviors:[{name:"scrollZoom",status:"disable"}],events:[],options:{suppressMapOpenBlock:!0}},e)).controls.length||e.map.controls.length||(e.controls=["zoomControl","typeSelector"]),o.ymap=new ymaps.Map(t.get(0),e.map,e.options),s=0;s<e.controls.length;s++)e.controls[s].name&&o.ymap.controls.add(e.controls[s].name,e.controls[s].params||{});for(s=0;s<e.behaviors.length;s++)if(void 0!==e.behaviors[s].name)switch(e.behaviors[s].status){case"enable":o.ymap.behaviors.enable(e.behaviors[s].name);break;case"disable":o.ymap.behaviors.disable(e.behaviors[s].name)}for(s=0;s<e.events.length;s++)void 0!==e.events[s].name&&"function"==typeof e.events[s].callback&&o.ymap.events.add(e.events[s].name,e.events[s].callback);e.placemark&&(ymaps.layout.storage.add("im#bLayout",ymaps.templateLayoutFactory.createClass('<div class="map-balloon tooltip tooltip_top visible"><div class="tooltip-arrow"></div><div class="balloon-content">{{ properties.balloonContent }}</div><i class="ix ix-x-gray"></i></div>',{build:function(){var e=this.getParentElement();this.constructor.superclass.build.call(this),this.$balloon=$(".map-balloon",e),this.$arrow=$(".tooltip-arrow",this.$balloon),this.$balloonContent=$(".balloon-content",this.$balloon),this.$closeButton=$(".ix-x-gray",e),this.$balloon.css({width:Math.min(this.$balloonContent.outerWidth(),t.outerWidth()-110)}),this.$balloon.css({left:-this.$balloon.outerWidth()/2,top:-(this.$balloon.outerHeight()+this.$arrow.outerHeight())}),this.attachListeners()},clear:function(){this.$balloonContent.empty(),this.detachListeners(),this.constructor.superclass.clear.call(this)},attachListeners:function(){this.$closeButton.on("click",ymaps.util.bind(this.onCloseButtonClick,this))},detachListeners:function(){this.$closeButton.off("click")},onCloseButtonClick:function(){this.events.fire("userclose")},getClientBounds:function(){var e=this.$balloon.position();return[[e.left,e.top],[e.left+this.$balloon.outerWidth(),e.top+this.$balloon.outerHeight()+this.$arrow.outerHeight()]]}})),n=new ymaps.Placemark(o.ymap.getCenter(),{balloonContent:e.placemark.balloonContent},{iconContentOffset:[3,5],iconLayout:"default#image",iconShadow:!0,iconImageHref:"/s/a/i/sprites/item-map-marker-sprite.png",iconImageClipRect:[[0,0],[23,35]],iconImageSize:[23,35],iconImageOffset:[-13,-35],iconShadowImageHref:"/s/a/i/sprites/item-map-marker-sprite.png",iconShadowImageClipRect:[[0,37],[15,44]],iconShadowImageSize:[15,7],iconShadowImageOffset:[-8,-2],hideIconOnBalloonOpen:!1,balloonLayout:"im#bLayout",balloonShadow:!1,balloonOffset:[-1,5],balloonZIndex:780}),o.ymap.geoObjects.add(n),n.balloon.open()),a.resolve()}).fail(a.reject),a.promise()},o},$.fn.yandexMap=function(e){return new $.YandexMap(this,$.extend({packages:["standard"]},e))}}(),function(){"use strict";var e,t=1e3,o={center:[55.756678,37.61804],zoom:15},n=5,a=avito&&avito.coords&&avito.coords.precisionMap||{10:1},s={mode:"default",searchFormSelector:"#search_form",regionFieldSelector:"#region",sortFieldSelector:".js-sort-select",expandBtnSelector:".expand",urlBtnContainerSelector:".url-btn-container",urlFieldSelector:"#map-url",amountInfoSelector:".amount-info",isShowCloseBtn:!0,classes:{expanding:"expanding",expanded:"expanded",close:"close",fullScreen:"fullscreen",loading:"loading",hidden:"hidden",itemsFit:"items-fit",lock:"scroll-lock",mapDummy:"map-dummy",balloon:"map-balloon",balloonCloseButton:"ix-x-gray",balloonContentHead:"balloon-content-head",balloonContentBody:"tooltip-content-body",cluster:"cluster",clusterContent:"cluster-content"},url:{geocode:"/js/coords/",coords:"/js/catalog/coords",items:"/js/catalog/items",catalog:"/js/catalog"},clusterer:{maxZoom:15,gridSize:64,zoomMargin:30,clusterOpenBalloonOnClick:!0,clusterIcons:[{href:"/s/a/i/sprites/map-cluster-sprite.png",size:[40,40],offset:[-20,-20],clipRect:[[0,118],[40,158]]},{href:"/s/a/i/sprites/map-cluster-sprite.png",size:[52,52],offset:[-26,-26],clipRect:[[0,62],[52,114]]},{href:"/s/a/i/sprites/map-cluster-sprite.png",size:[58,58],offset:[-29,-29],clipRect:[[0,0],[58,58]]}],clusterNumbers:[10,100],clusterIconLayout:"cm#clLayout",clusterIconShape:{type:"Circle",coordinates:[0,0],radius:20}},icon:{url:"/s/a/i/sprites/search-map-marker-sprite.png",size:[23,34],shadowSize:[15,7],shadowOffset:2},currency:"руб."},i=function(e,t){var o={};return function(n){var a="function"==typeof t?t(n):n;return o[a]&&"rejected"!==o[a].state()||(o[a]=e(n)),o[a]}},r={visitedList:function(){try{return JSON.parse(window.sessionStorage.getItem("avito.map.visited")||"[]")}catch(e){return[]}}(),setStatus:function(e,t){var o;$.isArray(this.visitedList)||(this.visitedList=[]),o=$.inArray(e,this.visitedList),t&&-1===o?this.visitedList.push(e):t||-1===o||this.visitedList.splice(o,1);try{window.sessionStorage.setItem("avito.map.visited",JSON.stringify(this.visitedList))}catch(e){}},getStatus:function(e){return-1!==$.inArray(e,this.visitedList)}},l=function(e){var t,o=function(o){var n,a,s,i,l,c=[],d={add:[],remove:[],rawTotal:0};for(s in t)t.hasOwnProperty(s)&&$.extend(t[s].properties,{iconFontClass:"",iconContent:"0",itemIds:[]});for(n in o)o.hasOwnProperty(n)&&(s=(a=[o[n].lat,o[n].lon]).join(","),c.push(s),t[s]?(i=t[s].properties.itemIds,$.isArray(i)&&-1===$.inArray(n,i)&&$.extend(t[s].properties,{itemIds:i.concat(n),iconContent:i.length+1,iconFontClass:i.length>98?"small-font":""})):(l=r.getStatus(s),t[s]={type:"Feature",id:s,geometry:{type:"Point",coordinates:a},properties:{iconFontClass:"",iconContent:"1",itemIds:[n],visited:l},options:$.extend({},e,l?{iconImageClipRect:[[e.iconImageSize[0]+4,0],[2*e.iconImageSize[0]+4,e.iconImageSize[1]]]}:{})},d.add.push(t[s])),d.rawTotal+=1);for(s in t)t.hasOwnProperty(s)&&-1===$.inArray(s,c)&&(d.remove.push(s),delete t[s]);return d},n=function(){t={}};return e=$.extend({},e),n(),{refresh:function(e){return o(e)},reset:function(){n()}}},c=function(e){function t(e){for(var t=-1,n=o.length,a=[];++t<n;)o[t].name===e&&a.push(t);if(a.length)for(t=0,n=a.length;t<n;t++)o.splice(a[t]-t,1)}var o=e.serializeArray();return{add:function(e){t(e.name),o.push(e)},remove:function(e){t(e)},getParamString:function(){return $.param(o)},isChildCategory:function(){for(var e=-1,t=o.length,n=!1,a=/^params/;++e<t;)o[e].value&&a.test(o[e].name)&&(n=!0);return n}}};e=function(e,s){function d(){e.on("click",s.expandBtnSelector,function(){u(!0)}).on("click","."+s.classes.close,function(){ae&&(m(!1),h(!1)),u(!1)}).on("click","."+s.classes.fullScreen,function(){m(),h()})}function u(t){t!==Y&&(Y=t,ne&&e.off("webkitTransitionEnd transitionend").removeClass(s.classes.expanding),t&&ne?(e.one("webkitTransitionEnd transitionend",function(){e.removeClass(s.classes.expanding).addClass(s.classes.expanded),p(!0)}),e.addClass(s.classes.expanding)):(e.toggleClass(s.classes.expanded,t),p(t)),t?f({autozoom:!0}):(y(!0),U.ymap.balloon.close()))}function p(e){U.ymap.controls.each(function(t){t.options.set({visible:e})})}function m(t,o){var a,i,r,l;(t=void 0===t?!ae:t)!==ae&&(ae=t,a=$(".nav",R),i=$(".js-nav-content",a),r=$(".search-map-full",R),l=document.querySelector(".js-search-filters-wrapper"),t?(te.addClass(s.classes.lock).on("keydown.full_map",function(e){27===e.keyCode&&(m(!1),h(!1))}),R.on("click.full_map",".overlay",function(){m(!1),h(!1)}),$.mediator.on("refresh_content.search_map",function(e,t){switch(t){case"beforeSend":a.addClass(s.classes.loading);break;case"always":a.removeClass(s.classes.loading);break;case"done":r.css({top:a.height()}),U.ymap.container.fitToViewport()}}),i.empty().append($(".js-breadcrumbs").clone()).append($(".catalog-counts").clone()).on("click.full_map",".js-catalog-counts__link, .js-breadcrumbs-link-interaction, .filter",function(e){var t,o,a,s=$(this),i=s.data("param"),r=s.attr("href");if(r){if(e.preventDefault(),s.is(".js-breadcrumbs-link-interaction")){var c=[];s.nextAll(".js-breadcrumbs-link").each(function(){(i=$(this).data("param"))&&(c.push(i.id),E.remove("params["+i.id+"]"))}),c.length&&l&&(a=new CustomEvent("resetFiltersValue",{detail:{resetFilterIds:c}}),l.dispatchEvent(a))}else s.is(".filter")?(t=s.data("user")||"",$("#search_form").find('input[name="user"]').val(t),E.add({name:"user",value:t})):i&&l&&(a=new CustomEvent("setFilterValues",{detail:{id:i.id,value:i.value}}),l.dispatchEvent(a),E.add({name:"params["+i.id+"]",value:i.value}));window.history&&window.history.pushState&&(o=$.url().attr("base")+r,window.history.pushState("","",o)),U.ymap.getZoom()<n&&U.ymap.setZoom(n),U.ymap.balloon.close(),f()}}),P=$('<div class="'+s.classes.mapDummy+'"></div>').css({height:e.height()}).insertAfter(e),R.removeClass(s.classes.hidden),r.css({top:a.height()}).append(e),(!o||!0!==o.noNavUpdate)&&U.ymap.getZoom()>=n&&a.addClass(s.classes.loading)):(U.ymap.balloon.close(),ue=!1,O(),te.removeClass(s.classes.lock).off("keydown.full_map"),R.off("click.full_map"),R.addClass(s.classes.hidden),i.empty().off("click.full_map"),$.mediator.off("search_map"),P.replaceWith(e)))}function h(e){(e=void 0===e?ae:e)?U.ymap.behaviors.enable("scrollZoom"):U.ymap.behaviors.disable("scrollZoom"),U.ymap.container.fitToViewport(),$.mediator.trigger(e?"mapOpened":"mapClosed")}function f(e){var t,o,a,i;(t=(e=e||{}).zoom||Math.round(U.ymap.getZoom()))<n?e.autozoom?U.ymap.setZoom(n):y(!1):(o=S(e.bounds||U.ymap.getBounds()),o+=","+Math.round(t),ae&&(o+=",f"),"item"===s.mode?(a=s.url.coords,i=$.extend({},J,{geo:o})):(a=[s.url.coords,E.getParamString()].join("?"),i={geo:o}),Q=$.getJSON(a,i).always(function(){Q=null}).done(function(e){var t,o=0;e&&("item"===s.mode&&e.coords&&e.coords[V]&&(he||(pe=e.coords[V].lat,me=e.coords[V].lon),delete e.coords[V],o++),"item"!==s.mode||he||(g(),he=!0),j({shown:o+=(t=X.refresh(e.coords)).rawTotal,total:e.count}),q.remove(t.remove).add(t.add))}),"item"!==s.mode&&(!1!==e.refreshContent&&O(o),!1!==e.updateUrl&&B(o)))}function g(){if(!pe&&!me)return null;var e=new ymaps.Placemark([pe,me],{itemIds:V},{iconContentOffset:[3,5],iconLayout:"default#image",iconImageHref:"/s/a/i/sprites/search-map-marker-sprite.png",iconImageClipRect:[[54,0],[69,23]],iconImageSize:[15,23],iconImageOffset:[-Math.ceil(7.5),-21],zIndex:651,hideIconOnBalloonOpen:!1,hasBalloon:!1});return U.ymap.geoObjects.add(e),null}function y(e){clearTimeout(K),v(),"item"!==s.mode&&e&&(O(),B("")),X.reset(),q&&q.removeAll(),D.removeClass("visible")}function v(){Q&&1===Q.readyState&&Q.abort(),ee&&1===ee.readyState&&ee.abort()}function b(e){var o,a,s;o=Math.round(e.get("oldZoom")),a=Math.round(e.get("newZoom")),s=e.get("newBounds"),a>=n?(clearTimeout(K),K=setTimeout(function(){var e=L(s,a),t=F(a);Math.round(o)===Math.round(a)&&_(e,oe.outerBoundsCoords,Math.pow(10,-(t+1)))||(v(),oe.outerBoundsCoords=e.slice(),f({bounds:s,zoom:a,refreshContent:!0}))},t)):o>=n&&y(!1)}function w(){var t,n,a,i,r=$.Deferred();return"item"===s.mode?(n=pe,a=me,i=parseFloat(e.data("map-zoom"))):t=C(e.data("coords")),t?r.resolve({bounds:t}):n&&a&&i?r.resolve({center:[n,a],zoom:i}):k().then(function(e){e=e||{},r.resolve($.extend({},o,e))}).catch(function(){r.resolve(o)}),r.promise()}function C(e){var t,o;return 4===(o=e.split(",")).length&&(t=[[o.shift(),o.shift()],[o.shift(),o.shift()]]),t}function S(e){return e=e||[],[].concat.apply([],e).toString()}function k(){return fetch(s.url.geocode+W,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({})}).then(function(e){if(!e.ok)throw new Error("Ошибка сервиса");return e.json()}).then(function(e){return{center:[e.latitude,e.longitude],zoom:e.zoom}})}function x(){return ymaps.templateLayoutFactory.createClass('<div class="'+s.classes.cluster+'"><span class="'+s.classes.clusterContent+'"></span></div>',{build:function(){var e=this.getParentElement(),t=this.getData(),o=t.properties.geoObjects,n=this.countItems(o),a=t.options.get("icons"),i=t.options.get("numbers"),r=0,l=i.length;for(this.constructor.superclass.build.call(this),this.$cluster=$("."+s.classes.cluster,e),this.$clusterContent=$("."+s.classes.clusterContent,this.$cluster),this.$clusterContent.text(n);r<l&&!(n<i[r]);r++);this.$cluster.css({"background-image":'url("'+a[r].href+'")',"background-position":-a[r].clipRect[0][0]+"px "+-a[r].clipRect[0][1]+"px",width:a[r].size[0],height:a[r].size[1],top:a[r].offset[1],left:a[r].offset[0],"line-height":a[r].size[1]+"px"})},clear:function(){this.$clusterContent.text("")},countItems:function(e){for(var t=0,o=0,n=e.length;o<n;o++)t+=(e[o].properties.itemIds||[]).length;return t}})}function I(){return ymaps.templateLayoutFactory.createClass(se.render(s.classes),{build:function(){var e=this.getParentElement(),t=this.getData();ue=!0,this.constructor.superclass.build.call(this),this.$balloon=$("."+s.classes.balloon,e),this.$arrow=$(".tooltip-arrow",this.$balloon),this.$closeButton=$("."+s.classes.balloonCloseButton,e),this.$balloonHead=$("."+s.classes.balloonContentHead,e),this.$balloonBody=$("."+s.classes.balloonContentBody,e),this.$balloonBody.addClass(s.classes.loading),ge({ids:t.object.properties.itemIds,coords:t.object.geometry.coordinates}).done(ymaps.util.bind(function(e){var t;if(this.onItemsLoaded(e.items),e.address)this.$balloonHead.html(e.address).attr("title",e.address);else for(t in e.items)if(e.items.hasOwnProperty(t)&&e.items[t].ext){this.$balloonHead.html(e.items[t].ext.address).attr("title",e.items[t].ext.address);break}},this)).always(ymaps.util.bind(function(){this.$balloonBody.removeClass(s.classes.loading)},this)).fail(ymaps.util.bind(function(){this.$balloonBody.html(de.render({itemText:1===t.itemIds.length?"объявление":"объявления"}))},this)),this.attachListeners(),this.applyElementOffset()},clear:function(){this.$balloonHead.empty(),this.$balloonBody.empty(),this.detachListeners(),this.constructor.superclass.clear.call(this)},attachListeners:function(){this.$closeButton.on("click",ymaps.util.bind(this.onCloseButtonClick,this))},detachListeners:function(){this.$closeButton.off("click")},onCloseButtonClick:function(e){e.preventDefault(),this.events.fire("userclose")},onItemsLoaded:function(e){this.renderItems(e),this.applyElementOffset()},renderItems:function(e){var t,o,n,a,i="",r="",l={prodam:"продам",sdam:"сдам"};if(e){for(t in e)e.hasOwnProperty(t)&&(n="",e[t].image_url&&(n=le.render({link:e[t].url,imgSrc:e[t].image_url})),"item"!==s.mode&&E.isChildCategory()||(a=l[e[t].type])&&(r=ce.render({type:e[t].type,text:a})),i+=re.render({link:e[t].url,title:e[t].title,price:H(e[t].price,e[t].currency,e[t].priceprops&&e[t].priceprops.postfix),image:n,type:r}));o=ie.render({items:i}),this.$balloonBody.html(o)}},applyElementOffset:function(){this.$balloon.css({left:-Math.floor(this.$balloon[0].offsetWidth/2),top:-(this.$balloon[0].offsetHeight+this.$arrow[0].offsetHeight)})},getClientBounds:function(){var e=this.$balloon.position();return[[e.left,e.top],[e.left+this.$balloon[0].offsetWidth,e.top+this.$balloon[0].offsetHeight+this.$arrow[0].offsetHeight]]},getShape:function(){if(!this.$balloon.length)return this.constructor.superclass.getShape.call(this);var e=this.$balloon.position();return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([[e.left,e.top],[e.left+this.$balloon[0].offsetWidth,e.top+this.$balloon[0].offsetHeight+this.$arrow[0].offsetHeight]]))}})}function O(e){e=e||"",$.mediator.trigger("refresh_content.search_map","beforeSend"),ee=$.getJSON([s.url.catalog,E.getParamString()].join("?"),{geo:e,s:oe.sorting,priceDimensionValue:s.priceDimensionValue}).always(function(){ee=null,$.mediator.trigger("refresh_content.search_map","always")}).done(function(e){var t;if(e){for(t in e)e.hasOwnProperty(t)&&$.mediator.trigger("catalog.init_block",[{name:t,html:e[t]}]);$.mediator.trigger("refresh_content.search_map","done")}}).fail(function(e,t){"error"===t&&$.mediator.trigger("catalog.clear_blocks")})}function B(e){var t,o=$.url().param();(e=e||"")?o.geo=e:delete o.geo,t=$.url().attr("path")+($.param(o)?"?"+$.param(o):""),window.history&&window.history.replaceState?window.history.replaceState("","",t):Z&&Z.val($.url().attr("base")+t).data("coords",e)}function j(e){e.total===e.shown?D.removeClass("visible"):D.find(".js-shown").text([e.shown,avito.i18n.plural(e.shown,["объявление","объявления","объявлений"])].join(" ")).end().find(".js-total").text(e.total).end().addClass("visible")}function z(){var e=A.find("button"),t=e.next(".tooltip");(Z=$(s.urlFieldSelector)).val(window.location.href),te.on("click",function(e){$(e.target).closest(s.urlBtnContainerSelector).length||t.hide()}),e.on("click",function(){t.toggle(),Z.get(0).select()}),Z.on("keydown",function(e){27===e.keyCode&&t.hide()})}function L(e,t){return $.map(e,function(e,o){return[$.map(e,function(e){return M(e,F(t),o)})]})}function M(e,t,o){var n,a=Math.floor(t),s=a===t?1:Math.round(1/(t-a)),i=Math.pow(10,a)*s;return n=e>0&&!o||e<0&&o?"floor":"ceil",Math[n](e*i)/i}function F(e){var t,o,n=1/0;if(e=Math.round(e),!a[e]){for(t in a)a.hasOwnProperty(t)&&n>Math.abs(e-a[t])&&(n=Math.abs(e-a[t]),o=parseInt(t,10));e=o}return a[e]}function _(e,t,o){var n,a;for(e=[].concat.apply([],e),t=[].concat.apply([],t),n=0,a=e.length;n<a;n++)if(Math.abs(e[n]-t[n])>o)return!1;return!0}function H(e,t,o){var n="";return e>10&&(n=[avito.number.currency(e,0),t||s.currency].join(" "),void 0!==o&&(n+=" "+o)),n}var T,R,P,A,Z,D,E,N,W,V,J,U,q,X,Y,G,K,Q,ee,te=$(document.body),oe={},ne=!te.hasClass("touch-device"),ae=!1,se=avito.simpleTemplate('<div class="{{balloon}} tooltip tooltip_top tooltip-heady visible"><div class="tooltip-arrow"></div><div class="balloon-content"><div class="tooltip-head"><div class="{{balloonContentHead}} fader"></div></div><div class="{{balloonContentBody}} has-loader"></div></div><i class="{{balloonCloseButton}}"></i></div>'),ie=avito.simpleTemplate('<ul class="list">{{items}}</ul>'),re=avito.simpleTemplate('<li class="item clearfix"><div class="item-image">{{image}}</div><div class="item-descr">{{type}}<span class="title fader"><a href="{{link}}" title="{{title}}" target="_blank">{{title}}</a></span><span class="price">{{price}}</span></div></li>'),le=avito.simpleTemplate('<a class="image-link" href="{{link}}" target="_blank"><img src="{{imgSrc}}"></a>'),ce=avito.simpleTemplate('<span class="type {{type}}">{{text}}</span>'),de=avito.simpleTemplate('<div class="balloon-error"><span class="c-8">Не удалось загрузить {{itemText}}</span></div>'),ue=!1,pe=parseFloat(e.data("map-lat")),me=parseFloat(e.data("map-lon")),he=!1,fe=e.data("show-neighbour")||!1,ge=i(function(e){return $.getJSON(s.url.items,{id:$.isArray(e.ids)?e.ids.join():e.ids,lat:e.coords[0],lng:e.coords[1],priceDimensionValue:s.priceDimensionValue})},function(e){return $.isArray(e.ids)?e.ids.sort(function(e,t){return e-t}).join():e.ids});"function"==typeof $.fn.yandexMap&&("item"===s.mode?(W=e.data("location-id"),V=e.data("item-id"),J={location_id:W,category_id:e.data("category-id"),shop:e.data("shop-id")},J=$.extend({},J,e.data("add-params"))):((E=c($(s.searchFormSelector))).remove("road[]"),E.remove("metro[]"),E.remove("district[]"),E.remove("geo"),(A=e.find(s.urlBtnContainerSelector))&&A.length&&z(),N=$(s.regionFieldSelector),W=N.val(),oe.sorting=$(s.sortFieldSelector).val()||"",s.hasFullScreen&&(R=$(".b-search-map-full",e).appendTo(te))),T=$(".search-map",e),D=$(s.amountInfoSelector,e),Y=e.hasClass(s.classes.expanded),G=Boolean(e.data("full")),U=T.yandexMap(),w().done(function(e){var t=[];t="item"===s.mode?[{name:"zoomControl"},{name:"rulerControl"}]:[{name:"zoomControl",params:{size:"small",position:{top:7,left:7}}}],G&&s.hasFullScreen&&m(!0,{noNavUpdate:!0}),U.init({map:e,controls:t,events:[{name:"boundschange",callback:function(e){ue||"item"===s.mode&&!fe?ue=!1:b(e)}}],options:{minZoom:n}}).done(function(){var e,t={};s.isShowCloseBtn&&(t.close=new ymaps.control.Button({data:{className:s.classes.close},options:{layout:ymaps.templateLayoutFactory.createClass('<button class="map-btn {{ data.className }}" type="button"></button>')}}),U.ymap.controls.add(t.close,{position:{right:14,top:14}})),"item"!==s.mode&&s.hasFullScreen&&(t.fullscreen=new ymaps.control.Button({data:{},options:{layout:ymaps.templateLayoutFactory.createClass('<button class="btn map-btn '+s.classes.fullScreen+'" type="button">На весь экран</button>')}}),U.ymap.controls.add(t.fullscreen,{position:{right:54,top:14}})),"item"!==s.mode&&d(),ymaps.layout.storage.add("cm#clLayout",x()).add("cm#pmContentLayout",ymaps.templateLayoutFactory.createClass('<i class="i-placemark {{ properties.iconFontClass }}">{{ properties.iconContent }}</i>')).add("cm#bLayout",I()),X=l({iconContentLayout:"cm#pmContentLayout",iconContentOffset:[3,5],iconShadow:!0,iconLayout:"default#imageWithContent",iconImageHref:s.icon.url,iconImageClipRect:[[0,0],s.icon.size],iconImageSize:s.icon.size,iconImageOffset:[-Math.ceil(s.icon.size[0]/2),-s.icon.size[1]],iconShadowImageHref:s.icon.url,iconShadowImageClipRect:[[0,s.icon.size[1]+s.icon.shadowOffset],[s.icon.shadowSize[0],s.icon.size[1]+s.icon.shadowOffset+s.icon.shadowSize[1]]],iconShadowImageSize:s.icon.shadowSize,iconShadowImageOffset:[-Math.ceil(s.icon.shadowSize[0]/2),-2]}),(q=new ymaps.ObjectManager($.extend({clusterize:!0,viewportMargin:32,geoObjectOpenBalloonOnClick:!1,geoObjectBalloonLayout:"cm#bLayout",geoObjectBalloonOffset:[0,5],geoObjectBalloonAutoPanMargin:110},s.clusterer))).objects.events.add("click",function(e){var t,o=e.get("objectId"),n=q.objects.getById(o);q.getObjectState(n).isClustered||(t=n.geometry.coordinates,q.objects.balloon.open(o),n.properties.visited||(q.objects.setObjectOptions(o,{iconImageClipRect:[[s.icon.size[0]+4,0],[2*s.icon.size[0]+4,s.icon.size[1]]]}),n.properties.visited=!0,r.setStatus(t.join(),!0)))}),U.ymap.geoObjects.add(q),e=U.ymap.getBounds(),oe.outerBoundsCoords=L(e,U.ymap.getZoom()),G&&s.hasFullScreen&&h(!0),Y?"item"!==s.mode||fe?f({bounds:e,refreshContent:!1}):g():p(!1)})}))},$.fn.searchMap=function(t){return this.each(function(){var o=$(this),n=o.data("SearchMap");n?"string"==typeof t&&n[t]&&n[t]():("object"!=typeof t&&void 0!==t||(t=$.extend(!0,{},s,t)),o.data("SearchMap",new e(o,t)))})}}();